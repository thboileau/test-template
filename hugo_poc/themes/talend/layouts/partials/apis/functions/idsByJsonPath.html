{{ $contract := . }}
{{/* Generate human readable ids for: sections, text, operations, types, security schemes ans scopes and handle collisions */}}

{{ $scratch := newScratch -}}
{{ range $key,$section := $contract.sections -}}
	{{ $anchor := (print "section_" $section.name) | anchorize -}}
	{{ $scratch.Add $anchor 1 -}}
	{{ if gt ($scratch.Get $anchor) 1 -}}
		{{ $anchor = print $anchor "_" ($scratch.Get $anchor) -}}
	{{ end -}}
	{{ $scratch.SetInMap "idsByJsonPath" (print "#/contract/sections/" $key) $anchor -}}
{{ end -}}
{{ range $key,$text := $contract.texts -}}
	{{ $anchor := (print "text_" $text.title) | anchorize -}}
	{{ $scratch.Add $anchor 1 -}}
	{{ if gt ($scratch.Get $anchor) 1 -}}
		{{ $anchor = print $anchor "_" ($scratch.Get $anchor) -}}
	{{ end -}}
	{{ $scratch.SetInMap "idsByJsonPath" (print "#/contract/texts/" $key) $anchor -}}
{{ end -}}
{{ range $key,$type := $contract.types -}}
	{{ $anchor := (print "type_" $type.name) | anchorize -}}
	{{ $scratch.Add $anchor 1 -}}
	{{ if gt ($scratch.Get $anchor) 1 -}}
		{{ $anchor = print $anchor "_" ($scratch.Get $anchor) -}}
	{{ end -}} 
	{{ $scratch.SetInMap "idsByJsonPath" (print "#/contract/types/" $key) $anchor -}} 
{{ end -}}
{{ range $securitySchemeKey,$securityScheme := $contract.securitySchemes -}}
	{{ $anchor := (print "securityScheme_" $securityScheme.name) | anchorize -}}
	{{ $scratch.Add $anchor 1 -}}
	{{ if gt ($scratch.Get $anchor) 1 -}}
		{{ $anchor = print $anchor "_" ($scratch.Get $anchor) -}}
	{{ end -}}
	{{ $scratch.SetInMap "idsByJsonPath" (print "#/contract/securitySchemes/" $securitySchemeKey) $anchor -}} 

	{{ with $securityScheme.settings.scopes -}}
		{{ range $scopeKey,$scope := . -}}
			{{ $scopeAnchor := (print "securitySchemeScope_" $scope.name) | anchorize -}}
			{{ $scratch.Add $scopeAnchor 1 -}}
			{{ if gt ($scratch.Get $scopeAnchor) 1 -}}
				{{ $scopeAnchor = print $scopeAnchor "_" ($scratch.Get $scopeAnchor) -}}
			{{ end -}}
			{{ $scratch.SetInMap "idsByJsonPath" (print "#/contract/securitySchemes/" $securitySchemeKey "/settings/scopes/" $scopeKey) $scopeAnchor -}} 
		{{ end -}}
	{{ end -}}
{{ end -}}
{{ range $contract.resources -}}
	{{ range $key,$operation := .operations -}}
		{{ $anchor := (print "operation_" $operation.name) | anchorize -}}
		{{ $scratch.Add $anchor 1 -}}
		{{ if gt ($scratch.Get $anchor) 1 -}}
			{{ $anchor = print $anchor "_" ($scratch.Get $anchor) -}}
		{{ end -}}
		{{ $scratch.SetInMap "idsByJsonPath" (print "#/contract/operations/" $key) $anchor -}}
	{{ end -}}
{{ end -}}
{{ return $scratch.Get "idsByJsonPath" -}}