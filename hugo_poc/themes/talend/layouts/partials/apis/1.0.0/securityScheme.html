{{ $itemsByJsonPath := .itemsByJsonPath -}}
{{ $idsByJsonPath := .idsByJsonPath -}}
{{ $apiDefinition := .apiDefinition }}
{{ $securitySchemeKey := .securitySchemeKey}}

{{ with .securityScheme }}
      {{ $id := index $idsByJsonPath (print "#/contract/securitySchemes/" $securitySchemeKey ) -}}
      <details class="security_scheme">
        <summary class="security-scheme__name" id="{{ $id }}"><span class="security-scheme__name--content">{{ .name }}</span> <svg viewBox="0 0 16 16" aria-hidden="true" class="security-scheme__name--icon"><path d="M8 13.6l-8-8L2.6 3 8 8.4 13.4 3 16 5.6z"></path></svg></summary>
        {{ with .description }}<div class="api-description wysiwyg">{{ . | markdownify }}</div>{{ end }}
        <table class="security-scheme__content">
          <caption class="security-scheme__type">{{ .type }}</caption>
          <thead class="sr-only">
          <tr>
            <th scope="col">{{ i18n "api-parameter-name" -}}</th>
            <th scope="col">{{ i18n "api-parameter-description" -}}</th>
          </tr>
          </thead>
          <tbody>
  {{ with .settings.authorizationGrants }}
          <tr class="security-scheme__parameter">
            <th scope="row">{{ i18n "api-security-grant" (len .) -}}</th>
            <td>{{ range . }}<span class="badge">{{ . }}</span>{{ end }}</td>
          </tr>
  {{ end }}
  {{ with .settings.authorizationUri }}
          <tr class="security-scheme__parameter">
            <th scope="row">{{ i18n "api-security-authorization-uri" -}}</th>
            <td><span class="badge">{{ . }}</span></td>
          </tr>
  {{ end }}
  {{ with .settings.accessTokenUri }}
          <tr class="security-scheme__parameter">
            <th scope="row">{{ i18n "api-security-access-token-uri" -}}</th>
            <td><span class="badge">{{ . }}</span></td>
          </tr>
  {{ end }}
  {{ with .settings.openIdConnectUrl }}
          <tr class="security-scheme__parameter">
            <th scope="row">{{ i18n "api-security-openid-connect-url" -}}</th>
            <td><span class="badge">{{ . }}</span></td>
          </tr>
  {{ end }}
  {{ with .settings.refreshUrl }}
          <tr class="security-scheme__parameter">
            <th scope="row">{{ i18n "api-security-refresh-url" -}}</th>
            <td><span class="badge">{{ . }}</span></td>
          </tr>
  {{ end }}
  {{ with .settings.bearerFormat }}
          <tr class="security-scheme__parameter">
            <th scope="row">{{ i18n "api-security-bearer-format" -}}</th>
            <td><span class="badge">{{ . }}</span></td>
          </tr>
  {{ end }}
  {{ with .settings.scopes }}
          <tr class="security-scheme__parameter">
            <th scope="row">{{ i18n "api-security-scope" (len .) -}}</th>
            <td>
              <ul class="example">
    {{ range $scopeKey,$scope := . }}
                {{ $scopeId := index $idsByJsonPath (print "#/contract/securitySchemes/" $securitySchemeKey "/settings/scopes/" $scopeKey ) }}
                <li class="example__value"><span class="badge">{{ $scope.name }}</span> <div class="TODO scope__description wysiwyg" id="{{ $scopeId }}">{{ $scope.description | markdownify }}</div></li> {{/* TODO not a span because markdown */}}
    {{ end }}
              </ul>
            </td>
          </tr>
  {{ end }}
          </tbody>
        </table>
  {{ with .describedBy }}
    {{ partial "apis/1.0.0/pathvariables_queryparameters_headers" (dict "itemsByJsonPath" $itemsByJsonPath "idsByJsonPath" $idsByJsonPath "apiDefinition" $apiDefinition "context" "request" "type" "parameters" "label" "Query Parameters" "params" .queryParameters) }}
    {{ partial "apis/1.0.0/pathvariables_queryparameters_headers" (dict "itemsByJsonPath" $itemsByJsonPath "idsByJsonPath" $idsByJsonPath "apiDefinition" $apiDefinition "context" "request" "type" "parameters" "label" "Headers" "params" .headers) }}
  {{ end }}
    </details>
{{ end }}
